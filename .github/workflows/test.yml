name: Test

on:
  pull_request:
    branches:
      - main

jobs:
  lint:
    name: Ansible Lint
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: pip3 install ansible-core ansible-lint yamllint

      - name: Run yamllint
        run: yamllint .

      - name: Run ansible-lint
        run: ansible-lint

  syntax-check:
    name: Syntax Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install Ansible
        run: pip3 install ansible-core

      - name: Create test playbook
        run: |
          cat > test-playbook.yml << 'EOF'
          ---
          - hosts: localhost
            connection: local
            gather_facts: false
            roles:
              - role: .
                telegram_bot_token: "test_token"
                telegram_chat_id: "test_chat_id"
          EOF

      - name: Run syntax check
        run: ansible-playbook test-playbook.yml --syntax-check
